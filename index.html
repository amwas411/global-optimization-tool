<!DOCTYPE html>
<html>
    <head>
        <script src="scripts/plotly-latest.min.js"></script>
        <script src="https://unpkg.com/mathjs@8.1.0/" type="text/html"></script>
        <script src="scripts/main.js"></script>
        
        <link href="styles.css" rel="stylesheet">
        <title>Global optimization project</title>
    </head>
    <body>
        <!--<a href="one-dimensional-optimization.html">1-dimensional optimization</a>-->
        <div id="plotly-container"></div>
        
        <form id="interface-container">
            <div id="returned-data">
                <div id="result"></div>
                <div id="method-iterations"></div>
                <div id="function-iterations"></div>
            </div>
            <div id="method-selector-container">
                <input id="method-hj" type="radio" name="method-selector" value="hj" checked>
                <label for="method-hj">Метод мультистарта</label>
                <input id="method-sa" type="radio" name="method-selector" value="sa">
                <label for="method-sa">Метод имитации отжига</label>
            </div>
            <div id="function-selector-container">
                <label for="function-input">Строка для ввода целевой функции</label>
                <input id="function-input" type="text" name="function-input" minlength="1" maxlength="100" size="100">
            </div>
            <div id="parameter-selector-container">

                <label for="param-x">x0</label>
                <input id="param-x" type="text" name="param-x" minlength="1" maxlength="8" size="10">
                <label for="param-y">y0</label>
                <input id="param-y" type="text" name="param-y" minlength="1" maxlength="8" size="10">
                <label for="max-iterations">Количество итераций</label>
                <input id="max-iterations" type="text" name="max-iterations" minlength="1" maxlength="8" size="10">
                <label for="lower-bound">Нижняя граница</label>
                <input id="lower-bound" type="text" name="lower-bound" minlength="1" maxlength="8" size="10">
                <label for="upper-bound">Верхняя граница</label>
                <input id="upper-bound" type="text" name="upper-bound" minlength="1" maxlength="8" size="10">
            </div>
            <div id="button-container">
                <button id="button-start" type="button">Запуск</button>
            </div>
        </form>
        
        <script>
            function GetPlot(returned){
                let graphDiv=document.getElementById("plotly-container");
                let X,Y,Z,minX,minY,x1,y1,fMin,labelsList,minZ;
                X=returned[0];
                Y=returned[1];
                Z=returned[2];
                minX=returned[3];
                minY=returned[4];
                x1=returned[5];
                y1=returned[6];
                fMin=returned[7];
                labelsList=returned[8];
                methodIter=returned[9];
                functionIter=returned[10];
                f0=returned[11];
                let resultDiv = document.getElementById("result");
                resultDiv.innerHTML="x = "+x1+"<br>y = "+y1+"<br>z = "+fMin+"<br>Просмотрено точек: "+minX.length;
                let mDiv = document.getElementById("method-iterations");
                mDiv.innerHTML="Итераций метода: "+methodIter;
                let fDiv = document.getElementById("function-iterations");
                fDiv.innerHTML="Вычислений целевой функции: "+functionIter;
                let contourData={
                x:X,
                y:Y,
                z:Z,
                type:"contour",
                contours: { start: fMin-20, end: fMin+100, size:10 } 
                };
                let scatterData={
                    x: minX,
                    y: minY,
                    type: "scatter",
                    line: { color: "red" },
                    marker: { width: 5 },
                    text: labelsList,
                    textposition: "top center",
                    mode:'lines+markers+text',
                    textfont: { color: "yellow" },
                    hoverinfo: "x+y+z"
                };
                let data = [scatterData,contourData];
                let layout={
                    margin: { t: 10 },
                    hovermode: "closest" };
                Plotly.newPlot( graphDiv, data,layout);
            }

            let interfaceForm = document.getElementById("interface-container");
            let btnStart = document.getElementById("button-start");
            btnStart.addEventListener("click",function(event){ 
                let selectedMethod,selectedFunction,x0,y0,maxIter,lowerBound,upperBound;
                let data = new FormData(interfaceForm);
                for (item of data) {
                    if (item[0] === "method-selector"){
                        selectedMethod=item[1];
                    }
                    else {
                        if (item[0] === "function-input"){
                            selectedFunction=item[1];
                        }
                        else {
                            if (item[0] === "param-x"){
                                x0 = item[1];
                            }
                            else {
                                if (item[0] === "param-y"){
                                    y0 = item[1];
                                }
                                else{
                                    if (item[0] === "max-iterations"){
                                        maxIter = item[1];
                                    }
                                    else {
                                        if (item[0] === "lower-bound"){
                                            lowerBound=item[1];
                                        }
                                        else{
                                            if (item[0] === "upper-bound"){
                                                upperBound=item[1];
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                //funcString='18 * 3 * x - 18 * x - 12 * x * y + 8 * y * y - 12 * y'
                
                let returned = StartOptimization(selectedMethod,selectedFunction,x0,y0,maxIter,lowerBound,upperBound);
                /*if (selectedMethod === "hj"){
                    returned = StartHJ(selectedFunction,x0,y0,iterationsBound,lowerBound,upperBound);
                }
                else {
                    returned = StartSA(selectedFunction,x0,y0,iterationsBound,lowerBound,upperBound);
                }*/
                GetPlot(returned);
            });
            
        </script>
    </body>
</html>
